<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Taekwondo Tracker</title>
<style>
body { font-family: Arial, sans-serif; margin:0; background:#f4f4f9; color:#333; overflow-x:hidden; }
h2 { margin-top:0; }
section { background:#fff; margin:20px auto; padding:20px; border-radius:8px; box-shadow:0 0 10px rgba(0,0,0,0.05); max-width:95%; }
table { width:100%; border-collapse:collapse; margin-bottom:20px; table-layout:auto; word-wrap:break-word; }
.table-container { overflow-x: auto; width: 100%; }
th,td { padding:10px; border:1px solid #ddd; text-align:left; font-size:14px; overflow-wrap: break-word; }
th { background:#e2e2f1; }
input[type="text"], input[type="number"], input[type="date"], select { width:95%; padding:6px; box-sizing:border-box; border-radius:4px; border:1px solid #ccc; }
input[type="checkbox"] { width:20px; height:20px; }
button { margin:5px; padding:8px 12px; border-radius:4px; border:none; background:#6c63ff; color:#fff; cursor:pointer; font-size:14px; }
button:hover { background:#534fd1; }
.control-panel { background:#e8e8f8; padding:20px; border-radius:8px; margin:20px auto; max-width:95%; display:flex; flex-wrap:wrap; gap:10px; justify-content:flex-start; }
.student-active{background:#e6ffe6;}
.modal { display:none; position:fixed; top:0; left:0; width:100%; height:100%; background: rgba(0,0,0,0.5); justify-content:center; align-items:center; z-index:1000; overflow:auto; padding:10px;}
.modal-content { background:#fff; padding:20px; border-radius:8px; width:400px; max-width:100%; max-height:90%; overflow-y:auto; }
.modal-header { font-weight:bold; margin-bottom:10px; }
.modal-footer { text-align:right; margin-top:10px; }
select[multiple] { height:60px; }
li { margin-bottom:5px; }
li button { background:#ff4d4d; margin-left:5px; font-size:12px; padding:2px 6px; }
li .upBtn, li .downBtn { background:#4d94ff; margin-left:3px; }
.count-display { margin-bottom:10px; font-weight:bold; }

/* Belt colors and gradients */
.belt-White { background: #ffffff; }
.belt-Junior-yellow { background: linear-gradient(90deg, #fffacd, #fff199); }
.belt-Yellow { background: linear-gradient(90deg, #ffff66, #ffeb3b); }
.belt-Advanced-yellow { background: linear-gradient(90deg, #fff44f, #ffeb3b); }
.belt-Junior-Green { background: linear-gradient(90deg, #a8e6a2, #90ee90); }
.belt-Green { background: linear-gradient(90deg, #66c466, #00b300); }
.belt-Advanced-Green { background: linear-gradient(90deg, #4caf50, #2e7d32); }
.belt-Junior-blue { background: linear-gradient(90deg, #add8e6, #87ceeb); }
.belt-Blue { background: linear-gradient(90deg, #6495ed, #4169e1); }
.belt-Advanced-Blue { background: linear-gradient(90deg, #1e90ff, #0d47a1); }
.belt-Junior-red { background: linear-gradient(90deg, #ff7f7f, #ff6666); }
.belt-Red { background: linear-gradient(90deg, #ff0000, #cc0000); }
.belt-Advanced-red { background: linear-gradient(90deg, #b71c1c, #7f0000); }
.belt-Recommend-Black-Level-1 { background: linear-gradient(90deg, #444444, #222222); color:#fff; }
.belt-Recommend-Black-Level-2 { background: linear-gradient(90deg, #555555, #222222); color:#fff; }
.belt-Recommend-Black-Level-3 { background: linear-gradient(90deg, #666666, #333333); color:#fff; }
.belt-Black-1st-degree { background: linear-gradient(90deg, #000000, #111111); color:#fff; }
.belt-Black-2nd-degree { background: linear-gradient(90deg, #0d0d0d, #1a1a1a); color:#fff; }
.belt-Black-3rd-degree { background: linear-gradient(90deg, #1a1a1a, #262626); color:#fff; }
.belt-Black-4th-degree { background: linear-gradient(90deg, #262626, #333333); color:#fff; }
.belt-Black-5th-degree { background: linear-gradient(90deg, #333333, #404040); color:#fff; }
.belt-Black-6th-degree { background: linear-gradient(90deg, #404040, #4d4d4d); color:#fff; }
.belt-Black-7th-degree { background: linear-gradient(90deg, #4d4d4d, #595959); color:#fff; }
.belt-Black-8th-degree { background: linear-gradient(90deg, #595959, #666666); color:#fff; }
.belt-Black-9th-degree { background: linear-gradient(90deg, #666666, #737373); color:#fff; }
</style>
</head>
<body>

<h1 style="text-align: center; background-color: #222; color: white; padding: 15px 0; margin: 0; font-family: Arial, sans-serif; font-size: 2em; border-bottom: 4px solid #ffcc00;">
Impact Martial Arts Belt Tracker
</h1>

<section id="dashboard">
<h2>Dashboard</h2>
<div id="beltCounts">No students yet.</div>
</section>

<section id="studentsSection">
<h2>Students</h2>
<div class="count-display" id="studentCounts"></div>
<label for="studentSearch">Search Students / Belt / Instructor / Location:</label>
<input type="text" id="studentSearch" placeholder="Type to filter..." oninput="searchStudents()">
<div class="table-container">
<table id="studentsTable">
<thead>
<tr>
<th>ID</th>
<th>Name</th>
<th>Birthdate</th>
<th>Age</th>
<th>Belt</th>
<th>Instructor</th>
<th>Location</th>
<th>Eligible</th>
<th>Next Eligible Date</th>
<th>Active</th>
<th>Actions</th>
</tr>
</thead>
<tbody></tbody>
</table>
</div>
<button onclick="openStudentModal()">Add Student</button>
</section>

<section id="beltTestsSection">
<h2>Belt Tests</h2>
<div class="count-display" id="eligibleCount"></div>
<div class="table-container">
<table id="beltTestsTable">
<thead>
<tr>
<th>Student</th>
<th>Belt</th>
<th>Date</th>
<th>Instructor(s)</th>
<th>Location</th>
<th>Result</th>
<th>Actions</th>
</tr>
</thead>
<tbody></tbody>
</table>
</div>
<button onclick="openTestModal()">Add Belt Test</button>
</section>

<section class="control-panel">
<h2>Control Panel</h2>
<div>
<button onclick="openBeltModal()">Manage Belts</button>
<button onclick="openInstructorModal()">Manage Instructors</button>
<button onclick="openLocationModal()">Manage Locations</button>
<button onclick="importAll()">Import Data</button>
<button onclick="exportAll()">Export Data</button>
<button onclick="resetData()">Reset Data</button>
</div>
</section>

<!-- MODALS -->
<div class="modal" id="studentModal">
<div class="modal-content">
<div class="modal-header">Add/Edit Student</div>
<div class="modal-body">
<label>Name: <input type="text" id="studentName"></label><br><br>
<label>Birthdate: <input type="date" id="studentBirthdate"></label><br><br>
<label>Belt: <select id="studentBelt"></select></label><br><br>
<label>Instructor: <select id="studentInstructor"></select></label><br><br>
<label>Location: <select id="studentLocation"></select></label><br><br>
<label>Eligible: <input type="checkbox" id="studentEligible"></label><br><br>
<label>Active: <input type="checkbox" id="studentActive"></label>
</div>
<div class="modal-footer">
<button onclick="closeStudentModal()">Cancel</button>
<button onclick="saveStudent()">Save</button>
</div>
</div>
</div>

<div class="modal" id="testModal">
<div class="modal-content">
<div class="modal-header">Add/Edit Belt Test</div>
<div class="modal-body">
<label>Student: <select id="testStudentId"></select></label><br><br>
<label>Belt: <select id="testBelt"></select></label><br><br>
<label>Date: <input type="date" id="testDate"></label><br><br>
<label>Instructor(s): <select id="testInstructors" multiple></select></label><br><br>
<label>Location: <select id="testLocation"></select></label>
<label>Result: 
<select id="testResult">
<option value="Pass">Pass</option>
<option value="Fail">Fail</option>
</select>
</label><br><br>
</div>
<div class="modal-footer">
<button onclick="closeTestModal()">Cancel</button>
<button onclick="saveTest()">Save</button>
</div>
</div>
</div>

<div class="modal" id="beltModal">
<div class="modal-content">
<div class="modal-header">Manage Belts</div>
<div class="modal-body">
<ul id="beltList"></ul>
<input type="text" id="newBeltName" placeholder="New Belt Name">
<button onclick="addBelt()">Add</button>
</div>
<div class="modal-footer"><button onclick="closeBeltModal()">Close</button></div>
</div>
</div>

<div class="modal" id="instructorModal">
<div class="modal-content">
<div class="modal-header">Manage Instructors</div>
<div class="modal-body">
<ul id="instructorList"></ul>
<input type="text" id="newInstructorName" placeholder="New Instructor Name">
<button onclick="addInstructor()">Add</button>
</div>
<div class="modal-footer"><button onclick="closeInstructorModal()">Close</button></div>
</div>
</div>

<div class="modal" id="locationModal">
<div class="modal-content">
<div class="modal-header">Manage Locations</div>
<div class="modal-body">
<ul id="locationList"></ul>
<input type="text" id="newLocationName" placeholder="New Location Name">
<button onclick="addLocation()">Add</button>
</div>
<div class="modal-footer"><button onclick="closeLocationModal()">Close</button></div>
</div>
</div>

<script>
// --- DATA, STORAGE, DASHBOARD, TABLES, MODALS ---
// This script is a direct continuation of your v2.5 functionality with full gradient belt update.
// --- DATA STORAGE ---
let students = JSON.parse(localStorage.getItem('students')) || [];
let belts = JSON.parse(localStorage.getItem('belts')) || [
    "White","Junior yellow","Yellow","Advanced yellow","Junior Green","Green","Advanced Green",
    "Junior blue","Blue","Advanced Blue","Junior red","Red","Advanced red",
    "Recommended Black Level 1","Recommended Black Level 2","Recommended Black Level 3",
    "Black 1st degree","Black 2nd degree","Black 3rd degree","Black 4th degree",
    "Black 5th degree","Black 6th degree","Black 7th degree","Black 8th degree","Black 9th degree"
];
let instructors = JSON.parse(localStorage.getItem('instructors')) || [];
let locations = JSON.parse(localStorage.getItem('locations')) || [];
let tests = JSON.parse(localStorage.getItem('tests')) || [];

// --- SAVE & LOAD ---
function saveData() {
    localStorage.setItem('students', JSON.stringify(students));
    localStorage.setItem('belts', JSON.stringify(belts));
    localStorage.setItem('instructors', JSON.stringify(instructors));
    localStorage.setItem('locations', JSON.stringify(locations));
    localStorage.setItem('tests', JSON.stringify(tests));
    updateDashboard();
    renderTables();
    renderBeltModal();
    renderStudentBeltOptions();
    renderTestBeltOptions();
}

// --- DASHBOARD ---
function updateDashboard() {
    let counts = {};
    belts.forEach(b => counts[b]=0);
    students.forEach(s => { if(counts[s.belt]!==undefined) counts[s.belt]++; });
    let html = '<ul>';
    for(let belt of belts){
        html += `<li><span class="belt-${belt.replace(/ /g,'-').replace(/'/g,'')}">${belt}: ${counts[belt]}</span></li>`;
    }
    html += '</ul>';
    document.getElementById('beltCounts').innerHTML = html;
}

// --- STUDENT TABLE ---
function renderTables() {
    const tbody = document.querySelector('#studentsTable tbody');
    tbody.innerHTML = '';
    students.forEach((s,i)=>{
        const tr = document.createElement('tr');
        tr.className = s.active ? 'student-active' : '';
        tr.innerHTML = `
            <td>${i+1}</td>
            <td>${s.name}</td>
            <td>${s.birthdate}</td>
            <td>${calculateAge(s.birthdate)}</td>
            <td><span class="belt-${s.belt.replace(/ /g,'-').replace(/'/g,'')}">${s.belt}</span></td>
            <td>${s.instructor}</td>
            <td>${s.location}</td>
            <td>${s.eligible ? 'Yes' : 'No'}</td>
            <td>${s.nextEligibleDate || ''}</td>
            <td>${s.active ? 'Yes' : 'No'}</td>
            <td>
                <button onclick="editStudent(${i})">Edit</button>
                <button onclick="deleteStudent(${i})">Delete</button>
            </td>
        `;
        tbody.appendChild(tr);
    });
    renderEligibleCount();
}

// --- ELIGIBILITY COUNTER ---
function renderEligibleCount() {
    const count = students.filter(s=>s.eligible).length;
    document.getElementById('eligibleCount').innerText = `Eligible Students: ${count}`;
}

// --- AGE CALCULATION ---
function calculateAge(birthdate) {
    const birth = new Date(birthdate);
    const diff = Date.now() - birth.getTime();
    const age = new Date(diff).getUTCFullYear()-1970;
    return age;
}

// --- SEARCH ---
function searchStudents() {
    const val = document.getElementById('studentSearch').value.toLowerCase();
    const tbody = document.querySelector('#studentsTable tbody');
    Array.from(tbody.rows).forEach(row=>{
        row.style.display = Array.from(row.cells).some(cell=>cell.innerText.toLowerCase().includes(val)) ? '' : 'none';
    });
}

// --- MODALS ---
function openStudentModal() { document.getElementById('studentModal').style.display='flex'; }
function closeStudentModal() { document.getElementById('studentModal').style.display='none'; }
function openTestModal() { document.getElementById('testModal').style.display='flex'; }
function closeTestModal() { document.getElementById('testModal').style.display='none'; }
function openBeltModal() { document.getElementById('beltModal').style.display='flex'; renderBeltModal(); }
function closeBeltModal() { document.getElementById('beltModal').style.display='none'; }
function openInstructorModal() { document.getElementById('instructorModal').style.display='flex'; renderInstructorModal(); }
function closeInstructorModal() { document.getElementById('instructorModal').style.display='none'; }
function openLocationModal() { document.getElementById('locationModal').style.display='flex'; renderLocationModal(); }
function closeLocationModal() { document.getElementById('locationModal').style.display='none'; }

// --- STUDENT CRUD ---
function saveStudent() {
    const name = document.getElementById('studentName').value;
    const birthdate = document.getElementById('studentBirthdate').value;
    const belt = document.getElementById('studentBelt').value;
    const instructor = document.getElementById('studentInstructor').value;
    const location = document.getElementById('studentLocation').value;
    const eligible = document.getElementById('studentEligible').checked;
    const active = document.getElementById('studentActive').checked;
    if(name && birthdate) {
        const editIndex = document.getElementById('studentModal').dataset.editIndex;
        if(editIndex!==undefined) {
            students[editIndex] = {name,birthdate,belt,instructor,location,eligible,active, nextEligibleDate:students[editIndex].nextEligibleDate};
            delete document.getElementById('studentModal').dataset.editIndex;
        } else {
            students.push({name,birthdate,belt,instructor,location,eligible,active,nextEligibleDate:null});
        }
        saveData();
        closeStudentModal();
    } else { alert('Name and Birthdate are required'); }
}
function editStudent(i){
    const s = students[i];
    document.getElementById('studentName').value = s.name;
    document.getElementById('studentBirthdate').value = s.birthdate;
    document.getElementById('studentBelt').value = s.belt;
    document.getElementById('studentInstructor').value = s.instructor;
    document.getElementById('studentLocation').value = s.location;
    document.getElementById('studentEligible').checked = s.eligible;
    document.getElementById('studentActive').checked = s.active;
    document.getElementById('studentModal').dataset.editIndex = i;
    openStudentModal();
}
function deleteStudent(i){ if(confirm('Delete this student?')) { students.splice(i,1); saveData(); } }

// --- BELT MODAL ---
function renderBeltModal() {
    const ul = document.getElementById('beltList');
    ul.innerHTML='';
    belts.forEach((b,i)=>{
        const li = document.createElement('li');
        li.innerHTML = `<span class="belt-${b.replace(/ /g,'-').replace(/'/g,'')}">${b}</span>
                        <button class="upBtn" onclick="moveBeltUp(${i})">↑</button>
                        <button class="downBtn" onclick="moveBeltDown(${i})">↓</button>
                        <button onclick="deleteBelt(${i})">X</button>`;
        ul.appendChild(li);
    });
}
function addBelt(){
    const val = document.getElementById('newBeltName').value;
    if(val && !belts.includes(val)) { belts.push(val); document.getElementById('newBeltName').value=''; saveData(); }
}
function deleteBelt(i){ if(confirm('Delete this belt?')){ belts.splice(i,1); saveData(); } }
function moveBeltUp(i){ if(i>0){ [belts[i-1],belts[i]]=[belts[i],belts[i-1]]; saveData(); } }
function moveBeltDown(i){ if(i<belts.length-1){ [belts[i+1],belts[i]]=[belts[i],belts[i+1]]; saveData(); } }

// --- RENDER SELECT OPTIONS ---
function renderStudentBeltOptions(){
    const sel = document.getElementById('studentBelt');
    sel.innerHTML='';
    belts.forEach(b=>{ const o=document.createElement('option'); o.value=b; o.text=b; sel.appendChild(o); });
}
function renderTestBeltOptions(){
    const sel = document.getElementById('testBelt');
    sel.innerHTML='';
    belts.forEach(b=>{ const o=document.createElement('option'); o.value=b; o.text=b; sel.appendChild(o); });
}
function renderInstructorModal(){
    const ul = document.getElementById('instructorList'); ul.innerHTML='';
    instructors.forEach((ins,i)=>{ const li=document.createElement('li'); li.innerHTML=`${ins}<button onclick="deleteInstructor(${i})">X</button>`; ul.appendChild(li); });
}
function renderLocationModal(){
    const ul = document.getElementById('locationList'); ul.innerHTML='';
    locations.forEach((loc,i)=>{ const li=document.createElement('li'); li.innerHTML=`${loc}<button onclick="deleteLocation(${i})">X</button>`; ul.appendChild(li); });
}
function addInstructor(){ const val=document.getElementById('newInstructorName').value; if(val&&!instructors.includes(val)){ instructors.push(val); document.getElementById('newInstructorName').value=''; saveData(); } }
function deleteInstructor(i){ if(confirm('Delete instructor?')){ instructors.splice(i,1); saveData(); } }
function addLocation(){ const val=document.getElementById('newLocationName').value; if(val&&!locations.includes(val)){ locations.push(val); document.getElementById('newLocationName').value=''; saveData(); } }
function deleteLocation(i){ if(confirm('Delete location?')){ locations.splice(i,1); saveData(); } }

// --- TEST CRUD ---
function saveTest(){
    const studentId = document.getElementById('testStudentId').value;
    const belt = document.getElementById('testBelt').value;
    const date = document.getElementById('testDate').value;
    const instructorEls = document.getElementById('testInstructors').selectedOptions;
    const location = document.getElementById('testLocation').value;
    const result = document.getElementById('testResult').value;
    if(studentId && belt && date && location){
        tests.push({studentId,belt,date,instructors:[...instructorEls].map(o=>o.value),location,result});
        saveData();
        closeTestModal();
    } else { alert('All fields required'); }
}

// --- RENDER STUDENT SELECTS ---
function renderStudentSelectOptions(){
    const sel = document.getElementById('testStudentId');
    sel.innerHTML='';
    students.forEach((s,i)=>{ const o=document.createElement('option'); o.value=i; o.text=s.name; sel.appendChild(o); });
}
function renderInstructorSelectOptions(){
    const sel = document.getElementById('testInstructors');
    sel.innerHTML='';
    instructors.forEach(ins=>{ const o=document.createElement('option'); o.value=ins; o.text=ins; sel.appendChild(o); });
}
function renderLocationSelectOptions(){
    const sel = document.getElementById('testLocation');
    sel.innerHTML='';
    locations.forEach(loc=>{ const o=document.createElement('option'); o.value=loc; o.text=loc; sel.appendChild(o); });
}

// --- IMPORT/EXPORT/RESET ---
function importAll(){
    const json = prompt('Paste JSON here');
    if(json){ try{ const obj=JSON.parse(json); students=obj.students||[]; belts=obj.belts||belts; instructors=obj.instructors||[]; locations=obj.locations||[]; tests=obj.tests||[]; saveData(); } catch(e){ alert('Invalid JSON'); } }
}
function exportAll(){ const data=JSON.stringify({students,belts,instructors,locations,tests}); prompt('Copy your data:',data); }
function resetData(){ if(confirm('Reset all data?')){ students=[]; belts=[...belts]; instructors=[]; locations=[]; tests=[]; saveData(); } }

// --- INITIAL RENDER ---
saveData();
renderStudentSelectOptions();
renderInstructorSelectOptions();
renderLocationSelectOptions();
renderStudentBeltOptions();
renderTestBeltOptions();

</script>
</body>
</html>