<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Taekwondo Belt Tracker</title>
<style>
body { font-family: Arial, sans-serif; margin: 20px; }
.container { max-width: 1200px; margin: auto; }
table { width: 100%; border-collapse: collapse; margin-top: 10px; }
th, td { border: 1px solid #ccc; padding: 6px; text-align: left; }
input, select, textarea, button { margin: 5px 0; padding: 5px; }
textarea { width: 100%; }
.dashboard { display: flex; justify-content: space-around; background-color: #eceff1; padding: 15px; border-radius: 8px; margin-bottom: 20px; }
.dashboard div { text-align: center; font-weight: bold; padding: 5px 10px; border-radius: 5px; }
.belt-White { background-color: #fff; color: #000; }
.belt-Yellow { background-color: #fff59d; color: #000; }
.belt-Green { background-color: #a5d6a7; color: #000; }
.belt-Blue { background-color: #81d4fa; color: #000; }
.belt-Red { background-color: #ef9a9a; color: #000; }
.belt-Black { background-color: #000; color: #fff; }
@media print {
    body * { visibility: hidden; }
    .printable, .printable * { visibility: visible; }
    .printable { position: absolute; left: 0; top: 0; width: 100%; }
    table { border-collapse: collapse; width: 100%; font-size: 12px; }
    table, th, td { border: 1px solid black; }
    th, td { padding: 4px; text-align: left; }
    button { display: none; }
}
</style>
</head>
<body>
<div class="container">
<h1>Taekwondo Belt Tracker</h1>

<div id="dashboard" class="dashboard">
<div id="beltCounts"></div>
</div>

<input type="text" id="searchInput" placeholder="Search by student name, belt, instructor, or location...">

<h2>Add New Student</h2>
<form id="studentForm">
<input type="text" id="firstName" placeholder="First Name" required>
<input type="text" id="lastName" placeholder="Last Name" required>
<input type="date" id="dob" required>
<select id="currentBelt" required>
<option value="">Select Belt</option>
<option value="White">White</option>
<option value="Yellow">Yellow</option>
<option value="Green">Green</option>
<option value="Blue">Blue</option>
<option value="Red">Red</option>
<option value="Black">Black</option>
</select>
<select id="instructorSelect" required>
<option value="">Select Instructor</option>
</select>
<select id="locationSelect" required>
<option value="">Select Location</option>
</select>
<button type="submit">Add Student</button>
</form>

<button id="exportStudentsBtn">Export Students CSV</button>
<button onclick="printSection('studentsTable')">Print Student List</button>
<button id="resetDemoBtn" style="background-color:#f44336; color:#fff;">Reset Demo Data</button>

<h2>Students</h2>
<table id="studentsTable">
<thead>
<tr>
<th>ID</th><th>Name</th><th>DOB</th><th>Current Belt</th><th>Eligible?</th><th>Instructor</th><th>Location</th><th>Actions</th>
</tr>
</thead>
<tbody></tbody>
</table>

<h2>Manage Instructors</h2>
<form id="instructorForm">
<input type="text" id="instructorName" placeholder="Instructor Name" required>
<button type="submit">Add Instructor</button>
</form>
<table id="instructorTable">
<thead><tr><th>Instructor</th><th>Actions</th></tr></thead>
<tbody></tbody>
</table>

<h2>Manage Locations</h2>
<form id="locationForm">
<input type="text" id="locationName" placeholder="Location Name" required>
<button type="submit">Add Location</button>
</form>
<table id="locationTable">
<thead><tr><th>Location</th><th>Actions</th></tr></thead>
<tbody></tbody>
</table>

<h2>Record Belt Test</h2>
<form id="testForm">
<select id="studentTestSelect" required>
<option value="">Select Student</option>
</select>
<select id="beltTestedFor" required>
<option value="">Belt Tested For</option>
<option value="Yellow">Yellow</option>
<option value="Green">Green</option>
<option value="Blue">Blue</option>
<option value="Red">Red</option>
<option value="Black">Black</option>
</select>
<input type="date" id="testDate" required>
<select id="testResult" required>
<option value="">Result</option>
<option value="Pass">Pass</option>
<option value="Fail">Fail</option>
</select>
<textarea id="comments" placeholder="Comments"></textarea>
<button type="submit">Record Test</button>
</form>

<button id="exportTestsBtn">Export Tests CSV</button>
<button onclick="printSection('testsTable')">Print Test Records</button>

<h2>Belt Test Records</h2>
<table id="testsTable">
<thead><tr><th>Student</th><th>Belt Tested For</th><th>Date</th><th>Result</th><th>Comments</th><th>Actions</th></tr></thead>
<tbody></tbody>
</table>

</div>

<script>
const beltColors={White:"#fff",Yellow:"#fff59d",Green:"#a5d6a7",Blue:"#81d4fa",Red:"#ef9a9a",Black:"#000"};

function getData(key){ return JSON.parse(localStorage.getItem(key))||[]; }
function saveData(key,data){ localStorage.setItem(key, JSON.stringify(data)); }

function generateStudentId(){
    const students=getData('students');
    if(students.length===0) return 1000;
    const maxId=students.reduce((max,s)=>s.id>max?s.id:max,1000);
    if(maxId>=9999){ alert("Max students reached."); return null; }
    return maxId+1;
}

// Demo Data
if(!localStorage.getItem('students')){
    const demoStudents=[
        {id:1000,firstName:'Ethan',lastName:'Lee',dob:'2015-04-10',currentBelt:'White',eligible:'✔',instructor:'John Smith',location:'Main Dojo'},
        {id:1001,firstName:'Evelyn',lastName:'Kim',dob:'2016-07-22',currentBelt:'Yellow',eligible:'✔',instructor:'Jane Doe',location:'East Dojo'},
        {id:1002,firstName:'Liam',lastName:'Chen',dob:'2014-11-05',currentBelt:'Green',eligible:'✔',instructor:'John Smith',location:'Main Dojo'}
    ];
    saveData('students',demoStudents);
}
if(!localStorage.getItem('instructors')){
    saveData('instructors',['John Smith','Jane Doe']);
}
if(!localStorage.getItem('locations')){
    saveData('locations',['Main Dojo','East Dojo']);
}
if(!localStorage.getItem('tests')){
    const demoTests=[
        {studentId:1000,studentName:'Ethan Lee',beltTestedFor:'White',testDate:'2025-08-01',result:'Pass',comments:'Great start!'},
        {studentId:1001,studentName:'Evelyn Kim',beltTestedFor:'Yellow',testDate:'2025-07-15',result:'Pass',comments:'Good techniques.'},
        {studentId:1002,studentName:'Liam Chen',beltTestedFor:'Green',testDate:'2025-06-20',result:'Pass',comments:'Needs flexibility.'}
    ];
    saveData('tests',demoTests);
}

// DOM Elements
const studentForm=document.getElementById('studentForm');
const studentsTableBody=document.querySelector('#studentsTable tbody');
const instructorForm=document.getElementById('instructorForm');
const instructorTableBody=document.querySelector('#instructorTable tbody');
const locationForm=document.getElementById('locationForm');
const locationTableBody=document.querySelector('#locationTable tbody');
const instructorSelect=document.getElementById('instructorSelect');
const locationSelect=document.getElementById('locationSelect');
const searchInput=document.getElementById('searchInput');
const studentTestSelect=document.getElementById('studentTestSelect');
const testForm=document.getElementById('testForm');
const testsTableBody=document.querySelector('#testsTable tbody');
const exportStudentsBtn=document.getElementById('exportStudentsBtn');
const exportTestsBtn=document.getElementById('exportTestsBtn');
const resetDemoBtn=document.getElementById('resetDemoBtn');

// --- Render Functions ---
function renderInstructors(){
    const instructors=getData('instructors'); instructorTableBody.innerHTML=''; instructorSelect.innerHTML='<option value="">Select Instructor</option>';
    instructors.forEach((i,idx)=>{
        const row=document.createElement('tr');
        const nameCell=document.createElement('td'); nameCell.textContent=i; nameCell.contentEditable=true;
        const actCell=document.createElement('td');
        const saveBtn=document.createElement('button'); saveBtn.textContent='Save';
        saveBtn.addEventListener('click',()=>saveInstructor(idx,nameCell.textContent));
        const delBtn=document.createElement('button'); delBtn.textContent='Delete'; delBtn.style.color='red';
        delBtn.addEventListener('click',()=>deleteInstructor(idx));
        actCell.appendChild(saveBtn); actCell.appendChild(delBtn);
        row.appendChild(nameCell); row.appendChild(actCell); instructorTableBody.appendChild(row);

        const opt=document.createElement('option'); opt.value=i; opt.textContent=i; instructorSelect.appendChild(opt);
    });
}
function saveInstructor(idx,name){ const instructors=getData('instructors'); instructors[idx]=name; saveData('instructors',instructors); renderInstructors(); renderStudents(); }
function deleteInstructor(idx){ const instructors=getData('instructors'); instructors.splice(idx,1); saveData('instructors',instructors); renderInstructors(); renderStudents(); }

function renderLocations(){
    const locations=getData('locations'); locationTableBody.innerHTML=''; locationSelect.innerHTML='<option value="">Select Location</option>';
    locations.forEach((l,idx)=>{
        const row=document.createElement('tr');
        const nameCell=document.createElement('td'); nameCell.textContent=l; nameCell.contentEditable=true;
        const actCell=document.createElement('td');
        const saveBtn=document.createElement('button'); saveBtn.textContent='Save';
        saveBtn.addEventListener('click',()=>saveLocation(idx,nameCell.textContent));
        const delBtn=document.createElement('button'); delBtn.textContent='Delete'; delBtn.style.color='red';
        delBtn.addEventListener('click',()=>deleteLocation(idx));
        actCell.appendChild(saveBtn); actCell.appendChild(delBtn);
        row.appendChild(nameCell); row.appendChild(actCell); locationTableBody.appendChild(row);

        const opt=document.createElement('option'); opt.value=l; opt.textContent=l; locationSelect.appendChild(opt);
    });
}
function saveLocation(idx,name){ const locations=getData('locations'); locations[idx]=name; saveData('locations',locations); renderLocations(); renderStudents(); }
function deleteLocation(idx){ const locations=getData('locations'); locations.splice(idx,1); saveData('locations',locations); renderLocations(); renderStudents(); }

function renderStudents(){
    const students=getData('students');
    const filter=searchInput.value.toLowerCase();
    studentsTableBody.innerHTML=''; studentTestSelect.innerHTML='<option value="">Select Student</option>';
    students.forEach(s=>{
        const name=`${s.firstName} ${s.lastName}`.toLowerCase();
        if(filter && !name.includes(filter) && !s.currentBelt.toLowerCase().includes(filter) && !s.instructor.toLowerCase().includes(filter) && !s.location.toLowerCase().includes(filter)) return;

        const row=document.createElement('tr');
        const idCell=document.createElement('td'); idCell.textContent=s.id;
        const nameCell=document.createElement('td'); nameCell.textContent=`${s.firstName} ${s.lastName}`; nameCell.contentEditable=true;
        const dobCell=document.createElement('td'); dobCell.textContent=s.dob; dobCell.contentEditable=true;
        const beltCell=document.createElement('td'); beltCell.textContent=s.currentBelt; beltCell.classList.add('belt-'+s.currentBelt); beltCell.contentEditable=true;

        const eligibleCell=document.createElement('td'); eligibleCell.textContent=s.eligible||''; eligibleCell.contentEditable=true; eligibleCell.style.textAlign='center';

        const instructorCell=document.createElement('td'); instructorCell.textContent=s.instructor||''; instructorCell.contentEditable=true;
        const locationCell=document.createElement('td'); locationCell.textContent=s.location||''; locationCell.contentEditable=true;

        const actionsCell=document.createElement('td');
        const saveBtn=document.createElement('button'); saveBtn.textContent='Save';
        saveBtn.addEventListener('click',()=>saveStudentEdit(s.id,nameCell,dobCell,beltCell,eligibleCell,instructorCell,locationCell));
        const delBtn=document.createElement('button'); delBtn.textContent='Delete'; delBtn.style.color='red';
        delBtn.addEventListener('click',()=>deleteStudent(s.id));
        actionsCell.appendChild(saveBtn); actionsCell.appendChild(delBtn);

        row.appendChild(idCell); row.appendChild(nameCell); row.appendChild(dobCell); row.appendChild(beltCell);
        row.appendChild(eligibleCell); row.appendChild(instructorCell); row.appendChild(locationCell); row.appendChild(actionsCell);
        studentsTableBody.appendChild(row);

        const opt=document.createElement('option'); opt.value=s.id; opt.textContent=`${s.firstName} ${s.lastName}`;
        studentTestSelect.appendChild(opt);
    });
    renderTests();
    renderDashboard();
}

function saveStudentEdit(id,nameCell,dobCell,beltCell,eligibleCell,instructorCell,locationCell){
    const students=getData('students'); const s=students.find(st=>st.id===id);
    if(!s) return;
    const names=nameCell.textContent.trim().split(' '); if(names.length<2){ alert('Enter full name'); renderStudents(); return;}
    const dob=dobCell.textContent.trim(); const belt=beltCell.textContent.trim(); const eligible=eligibleCell.textContent.trim();
    const instructor=instructorCell.textContent.trim(); const location=locationCell.textContent.trim();
    const belts=['White','Yellow','Green','Blue','Red','Black'];
    if(!belts.includes(belt)){ alert('Invalid belt'); renderStudents(); return; }
    s.firstName=names[0]; s.lastName=names.slice(1).join(' '); s.dob=dob; s.currentBelt=belt; s.eligible=eligible; s.instructor=instructor; s.location=location;
    saveData('students',students); renderStudents();
}

function deleteStudent(id){
    if(confirm('Delete this student?')){
        let students=getData('students'); students=students.filter(s=>s.id!==id); saveData('students',students);
        let tests=getData('tests'); tests=tests.filter(t=>t.studentId!==id); saveData('tests',tests);
        renderStudents();
    }
}

// Student Form
studentForm.addEventListener('submit',e=>{
    e.preventDefault(); const id=generateStudentId(); if(id===null) return;
    const students=getData('students'); 
    const newS={
        id,
        firstName:document.getElementById('firstName').value,
        lastName:document.getElementById('lastName').value,
        dob:document.getElementById('dob').value,
        currentBelt:document.getElementById('currentBelt').value,
        eligible:'✔',
        instructor:document.getElementById('instructorSelect').value,
        location:document.getElementById('locationSelect').value
    };
    students.push(newS); saveData('students',students); studentForm.reset(); renderStudents();
});

// --- Belt Tests ---
testForm.addEventListener('submit',e=>{
    e.preventDefault();
    const tests=getData('tests'); const students=getData('students');
    const sid=parseInt(document.getElementById('studentTestSelect').value); const s=students.find(st=>st.id===sid);
    if(!s) return;
    const newT={studentId:sid,studentName:`${s.firstName} ${s.lastName}`,beltTestedFor:document.getElementById('beltTestedFor').value,testDate:document.getElementById('testDate').value,result:document.getElementById('testResult').value,comments:document.getElementById('comments').value};
    if(newT.result==='Pass'){ s.currentBelt=newT.beltTestedFor; saveData('students',students);}
    tests.push(newT); saveData('tests',tests); renderTests(); renderStudents();
});

function renderTests(){
    const tests=getData('tests'); testsTableBody.innerHTML='';
    tests.forEach(t=>{
        const row=document.createElement('tr');
        ['studentName','beltTestedFor','testDate','result','comments'].forEach(key=>{
            const td=document.createElement('td'); td.textContent=t[key]; td.contentEditable=true; row.appendChild(td);
        });
        const act=document.createElement('td');
        const saveBtn=document.createElement('button'); saveBtn.textContent='Save';
        saveBtn.addEventListener('click',()=>saveTestEdit(t,row));
        const delBtn=document.createElement('button'); delBtn.textContent='Delete'; delBtn.style.color='red';
        delBtn.addEventListener('click',()=>deleteTest(t));
        act.appendChild(saveBtn); act.appendChild(delBtn); row.appendChild(act);
        testsTableBody.appendChild(row);
    });
}

function saveTestEdit(test,row){
    const cells=row.querySelectorAll('td');
    test.studentName=cells[0].textContent.trim();
    test.beltTestedFor=cells[1].textContent.trim();
    test.testDate=cells[2].textContent.trim();
    test.result=cells[3].textContent.trim();
    test.comments=cells[4].textContent.trim();
    const tests=getData('tests'); saveData('tests',tests);
    renderTests(); renderStudents();
}

function deleteTest(test){
    if(confirm('Delete this test record?')){
        let tests=getData('tests'); tests=tests.filter(t=>t!==test);
        saveData('tests',tests); renderTests(); renderStudents();
    }
}

// Dashboard
function renderDashboard(){
    const students=getData('students');
    const counts={White:0,Yellow:0,Green:0,Blue:0,Red:0,Black:0};
    students.forEach(s=>{ if(counts[s.currentBelt]!==undefined) counts[s.currentBelt]++; });
    const beltCountsDiv=document.getElementById('beltCounts');
    beltCountsDiv.innerHTML='';
    for(const belt in counts){
        const div=document.createElement('div'); div.textContent=`${belt}: ${counts[belt]}`;
        div.style.backgroundColor=beltColors[belt]; div.style.color=belt==='Black'?'#fff':'#000';
        beltCountsDiv.appendChild(div);
    }
}

// CSV Export
function exportToCSV(filename, rows){
    const csvContent = rows.map(e=>e.map(a=>`"${a}"`).join(',')).join('\n');
    const blob = new Blob([csvContent], {type:'text/csv;charset=utf-8;'});
    const link=document.createElement('a'); link.href=URL.createObjectURL(blob); link.download=filename; link.click();
}
exportStudentsBtn.addEventListener('click',()=>{
    const students=getData('students');
    const rows=[['ID','First Name','Last Name','DOB','Belt','Eligible','Instructor','Location']];
    students.forEach(s=>rows.push([s.id,s.firstName,s.lastName,s.dob,s.currentBelt,s.eligible,s.instructor,s.location]));
    exportToCSV('students.csv',rows);
});
exportTestsBtn.addEventListener('click',()=>{
    const tests=getData('tests');
    const rows=[['Student','Belt Tested For','Date','Result','Comments']];
    tests.forEach(t=>rows.push([t.studentName,t.beltTestedFor,t.testDate,t.result,t.comments]));
    exportToCSV('tests.csv',rows);
});

// Print Section
function printSection(tableId){
    const table=document.getElementById(tableId);
    const newWin=window.open(''); newWin.document.write('<html><head><title>Print</title></head><body>');
    newWin.document.write('<div class="printable">'+table.outerHTML+'</div>'); newWin.document.write('</body></html>'); newWin.print();
}

// Demo Reset
resetDemoBtn.addEventListener('click',()=>{
    if(confirm('Reset demo data? This will erase all changes.')){
        localStorage.clear(); location.reload();
    }
});

// Instructor/Location Forms
instructorForm.addEventListener('submit',e=>{ e.preventDefault(); const name=document.getElementById('instructorName').value.trim(); if(!name) return; const instructors=getData('instructors'); instructors.push(name); saveData('instructors',instructors); document.getElementById('instructorName').value=''; renderInstructors(); });
locationForm.addEventListener('submit',e=>{ e.preventDefault(); const name=document.getElementById('locationName').value.trim(); if(!name) return; const locations=getData('locations'); locations.push(name); saveData('locations',locations); document.getElementById('locationName').value=''; renderLocations(); });

// Search
searchInput.addEventListener('input',()=>{ renderStudents(); });

// Initial Render
renderInstructors(); renderLocations(); renderStudents(); renderDashboard();
</script>
</body>
</html>