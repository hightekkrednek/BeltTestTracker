<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Taekwondo Belt Tracker</title>
<style>
body { font-family: Arial, sans-serif; margin: 20px; }
.container { max-width: 1200px; margin: auto; }
table { width: 100%; border-collapse: collapse; margin-top: 10px; }
th, td { border: 1px solid #ccc; padding: 6px; text-align: left; }
input, select, textarea, button { margin: 5px 0; padding: 5px; }
textarea { width: 100%; }
.dashboard { display: flex; justify-content: space-around; background-color: #eceff1; padding: 15px; border-radius: 8px; margin-bottom: 20px; }
.dashboard div { text-align: center; font-weight: bold; padding: 5px 10px; border-radius: 5px; }
.belt-White { background-color: #fff; color: #000; }
.belt-Yellow { background-color: #fff59d; color: #000; }
.belt-Green { background-color: #a5d6a7; color: #000; }
.belt-Blue { background-color: #81d4fa; color: #000; }
.belt-Red { background-color: #ef9a9a; color: #000; }
.belt-Black { background-color: #000; color: #fff; }
@media print {
    body * { visibility: hidden; }
    .printable, .printable * { visibility: visible; }
    .printable { position: absolute; left: 0; top: 0; width: 100%; }
    table { border-collapse: collapse; width: 100%; font-size: 12px; }
    table, th, td { border: 1px solid black; }
    th, td { padding: 4px; text-align: left; }
    button { display: none; }
}
</style>
</head>
<body>
<div class="container">
<h1>Taekwondo Belt Tracker</h1>

<div id="dashboard" class="dashboard">
<div id="beltCounts"></div>
<div id="testSummary"></div>
</div>

<input type="text" id="searchInput" placeholder="Search by student name or belt...">

<h2>Add New Student</h2>
<form id="studentForm">
<input type="text" id="firstName" placeholder="First Name" required>
<input type="text" id="lastName" placeholder="Last Name" required>
<input type="date" id="dob" required>
<select id="currentBelt" required>
<option value="">Select Belt</option>
<option value="White">White</option>
<option value="Yellow">Yellow</option>
<option value="Green">Green</option>
<option value="Blue">Blue</option>
<option value="Red">Red</option>
<option value="Black">Black</option>
</select>
<button type="submit">Add Student</button>
</form>

<button id="exportStudentsBtn">Export Students CSV</button>
<button onclick="printSection('studentsTable')">Print Student List</button>
<button id="resetDemoBtn" style="background-color:#f44336; color:#fff;">Reset Demo Data</button>

<h2>Students</h2>
<table id="studentsTable">
<thead>
<tr><th>ID</th><th>Name</th><th>DOB</th><th>Current Belt</th><th>Eligible?</th><th>Actions</th></tr>
</thead>
<tbody></tbody>
</table>

<h2>Record Belt Test</h2>
<form id="testForm">
<select id="studentSelect" required>
<option value="">Select Student</option>
</select>
<select id="beltTestedFor" required>
<option value="">Belt Tested For</option>
<option value="Yellow">Yellow</option>
<option value="Green">Green</option>
<option value="Blue">Blue</option>
<option value="Red">Red</option>
<option value="Black">Black</option>
</select>
<input type="date" id="testDate" required>
<select id="testResult" required>
<option value="">Result</option>
<option value="Pass">Pass</option>
<option value="Fail">Fail</option>
</select>
<textarea id="comments" placeholder="Comments"></textarea>
<button type="submit">Record Test</button>
</form>

<button id="exportTestsBtn">Export Tests CSV</button>
<button onclick="printSection('testsTable')">Print Test Records</button>

<h2>Belt Test Records</h2>
<table id="testsTable">
<thead><tr><th>Student</th><th>Belt Tested For</th><th>Date</th><th>Result</th><th>Comments</th><th>Actions</th></tr></thead>
<tbody></tbody>
</table>

</div>

<script>
const beltColors={White:"#fff",Yellow:"#fff59d",Green:"#a5d6a7",Blue:"#81d4fa",Red:"#ef9a9a",Black:"#000"};

function getData(key){ return JSON.parse(localStorage.getItem(key))||[]; }
function saveData(key,data){ localStorage.setItem(key, JSON.stringify(data)); }

function generateStudentId(){
    const students=getData('students');
    if(students.length===0) return 1000;
    const maxId=students.reduce((max,s)=>s.id>max?s.id:max,1000);
    if(maxId>=9999){ alert("Max students reached."); return null; }
    return maxId+1;
}

// Demo Data
if(!localStorage.getItem('students')){
    const demoStudents=[
        {id:1000,firstName:'Ethan',lastName:'Lee',dob:'2015-04-10',currentBelt:'White'},
        {id:1001,firstName:'Evelyn',lastName:'Kim',dob:'2016-07-22',currentBelt:'Yellow'},
        {id:1002,firstName:'Liam',lastName:'Chen',dob:'2014-11-05',currentBelt:'Green'}
    ];
    saveData('students',demoStudents);
}
if(!localStorage.getItem('tests')){
    const demoTests=[
        {studentId:1000,studentName:'Ethan Lee',beltTestedFor:'White',testDate:'2025-08-01',result:'Pass',comments:'Great start!'},
        {studentId:1001,studentName:'Evelyn Kim',beltTestedFor:'Yellow',testDate:'2025-07-15',result:'Pass',comments:'Good techniques.'},
        {studentId:1002,studentName:'Liam Chen',beltTestedFor:'Green',testDate:'2025-06-20',result:'Pass',comments:'Needs flexibility.'}
    ];
    saveData('tests',demoTests);
}

// DOM Elements
const studentForm=document.getElementById('studentForm');
const studentsTableBody=document.querySelector('#studentsTable tbody');
const studentSelect=document.getElementById('studentSelect');
const searchInput=document.getElementById('searchInput');
const testForm=document.getElementById('testForm');
const testsTableBody=document.querySelector('#testsTable tbody');
const exportStudentsBtn=document.getElementById('exportStudentsBtn');
const exportTestsBtn=document.getElementById('exportTestsBtn');
const resetDemoBtn=document.getElementById('resetDemoBtn');

// --- Render Functions ---
function renderStudents(){
    const students=getData('students');
    const filter=searchInput.value.toLowerCase();
    studentsTableBody.innerHTML='';
    studentSelect.innerHTML='<option value="">Select Student</option>';
    students.forEach(s=>{
        const name=`${s.firstName} ${s.lastName}`.toLowerCase();
        if(filter && !name.includes(filter) && !s.currentBelt.toLowerCase().includes(filter)) return;

        const row=document.createElement('tr');
        const idCell=document.createElement('td'); idCell.textContent=s.id;
        const nameCell=document.createElement('td'); nameCell.textContent=`${s.firstName} ${s.lastName}`; nameCell.contentEditable=true;
        const dobCell=document.createElement('td'); dobCell.textContent=s.dob; dobCell.contentEditable=true;
        const beltCell=document.createElement('td'); beltCell.textContent=s.currentBelt; beltCell.classList.add('belt-'+s.currentBelt); beltCell.contentEditable=true;

        // Eligibility checkmark
        const eligibleCell=document.createElement('td'); 
        eligibleCell.innerHTML='&#10003;'; // âœ”
        eligibleCell.style.color='green'; 
        eligibleCell.style.textAlign='center';

        const actionsCell=document.createElement('td');
        const saveBtn=document.createElement('button'); saveBtn.textContent='Save';
        saveBtn.addEventListener('click',()=>saveStudentEdit(s.id,nameCell,dobCell,beltCell));
        const delBtn=document.createElement('button'); delBtn.textContent='Delete'; delBtn.style.color='red';
        delBtn.addEventListener('click',()=>deleteStudent(s.id));
        actionsCell.appendChild(saveBtn); actionsCell.appendChild(delBtn);

        row.appendChild(idCell); row.appendChild(nameCell); row.appendChild(dobCell); row.appendChild(beltCell);
        row.appendChild(eligibleCell); row.appendChild(actionsCell);
        studentsTableBody.appendChild(row);

        const opt=document.createElement('option'); opt.value=s.id; opt.textContent=`${s.firstName} ${s.lastName}`;
        studentSelect.appendChild(opt);
    });
    renderTests();
    renderDashboard();
}

function saveStudentEdit(id,nameCell,dobCell,beltCell){
    const students=getData('students'); const s=students.find(st=>st.id===id);
    if(!s) return;
    const names=nameCell.textContent.trim().split(' '); if(names.length<2){ alert('Enter full name'); renderStudents(); return;}
    const dob=dobCell.textContent.trim();
    const belt=beltCell.textContent.trim();
    const belts=['White','Yellow','Green','Blue','Red','Black'];
    if(!belts.includes(belt)){ alert('Invalid belt'); renderStudents(); return; }
    if(!/^\d{4}-\d{2}-\d{2}$/.test(dob)){ alert('Use YYYY-MM-DD'); renderStudents(); return; }
    s.firstName=names[0]; s.lastName=names.slice(1).join(' '); s.dob=dob; s.currentBelt=belt;
    saveData('students',students); renderStudents();
}

function deleteStudent(id){
    if(confirm('Delete this student?')){
        let students=getData('students'); students=students.filter(s=>s.id!==id); saveData('students',students);
        let tests=getData('tests'); tests=tests.filter(t=>t.studentId!==id); saveData('tests',tests);
        renderStudents();
    }
}

// Student Form
studentForm.addEventListener('submit',e=>{
    e.preventDefault(); const id=generateStudentId(); if(id===null) return;
    const students=getData('students'); 
    const newS={id,firstName:document.getElementById('firstName').value,lastName:document.getElementById('lastName').value,dob:document.getElementById('dob').value,currentBelt:document.getElementById('currentBelt').value};
    students.push(newS); saveData('students',students); studentForm.reset(); renderStudents();
});

// Tests
testForm.addEventListener('submit',e=>{
    e.preventDefault();
    const tests=getData('tests'); const students=getData('students');
    const sid=parseInt(document.getElementById('studentSelect').value); const s=students.find(st=>st.id===sid);
    if(!s) return;
    const newT={studentId:sid,studentName:`${s.firstName} ${s.lastName}`,beltTestedFor:document.getElementById('beltTestedFor').value,testDate:document.getElementById('testDate').value,result:document.getElementById('testResult').value,comments:document.getElementById('comments').value};
    if(newT.result==='Pass'){ s.currentBelt=newT.beltTestedFor; saveData('students',students);}
    tests.push(newT); saveData('tests',tests); renderTests(); renderStudents();
});

function renderTests(){
    const tests=getData('tests'); testsTableBody.innerHTML='';
    tests.forEach(t=>{
        const row=document.createElement('tr');
        ['studentName','beltTestedFor','testDate','result','comments'].forEach(key=>{
            const td=document.createElement('td'); td.textContent=t[key]; td.contentEditable=true; row.appendChild(td);
        });
        const act=document.createElement('td');
        const saveBtn=document.createElement('button'); saveBtn.textContent='Save';
        saveBtn.addEventListener('click',()=>saveTestEdit(t,row));
        const delBtn=document.createElement('button'); delBtn.textContent='Delete'; delBtn.style.color='red';
        delBtn.addEventListener('click',()=>deleteTest(t));
        act.appendChild(saveBtn); act.appendChild(delBtn); row.appendChild(act);
        testsTableBody.appendChild(row);
    });
}

function saveTestEdit(test,row){
    const tests=getData('tests'); const t=tests.find(x=>x.studentId===test.studentId && x.testDate===test.testDate && x.beltTestedFor===test.beltTestedFor);
    if(!t) return;
    t.studentName=row.cells[0].textContent; t.beltTestedFor=row.cells[1].textContent;
    t.testDate=row.cells[2].textContent; t.result=row.cells[3].textContent; t.comments=row.cells[4].textContent;
    saveData('tests',tests); renderTests(); renderDashboard();
}

function deleteTest(test){
    if(confirm('Delete this test?')){
        let tests=getData('tests'); tests=tests.filter(t=>!(t.studentId===test.studentId && t.testDate===test.testDate && t.beltTestedFor===test.beltTestedFor)); saveData('tests',tests); renderTests(); renderDashboard();
    }
}

// Dashboard
function renderDashboard(){
    const students=getData('students'); const tests=getData('tests');
    const beltCounts={White:0,Yellow:0,Green:0,Blue:0,Red:0,Black:0};
    students.forEach(s=>beltCounts[s.currentBelt]++);
    const beltDiv=document.getElementById('beltCounts'); beltDiv.innerHTML=''; for(const b in beltCounts){ const d=document.createElement('div'); d.textContent=`${b}: ${beltCounts[b]}`; beltDiv.appendChild(d);}
    const pass=tests.filter(t=>t.result==='Pass').length; const fail=tests.filter(t=>t.result==='Fail').length;
    document.getElementById('testSummary').textContent=`Pass: ${pass} | Fail: ${fail}`;
}

// CSV Export
function exportCSV(data, filename){
    const csv=data.map(row=>Object.values(row).map(v=>`"${v}"`).join(',')).join('\n');
    const blob=new Blob([csv], {type:'text/csv'}); const url=URL.createObjectURL(blob);
    const a=document.createElement('a'); a.href=url; a.download=filename; a.click(); URL.revokeObjectURL(url);
}
exportStudentsBtn.addEventListener('click', ()=>exportCSV(getData('students').map(s=>{
    return {id:s.id, firstName:s.firstName, lastName:s.lastName, dob:s.dob, currentBelt:s.currentBelt, eligible:'Yes'};
}), 'students.csv'));
exportTestsBtn.addEventListener('click', ()=>exportCSV(getData('tests'),'tests.csv'));

// Print
function printSection(id){
    const elem=document.getElementById(id);
    const newWin=window.open('','Print','width=900,height=600');
    newWin.document.write('<html><head><title>Print</title></head><body>'+elem.outerHTML+'</body></html>');
    newWin.document.close(); newWin.focus(); newWin.print(); newWin.close();
}

// Reset Demo
resetDemoBtn.addEventListener('click', ()=>{
    if(confirm('Reset demo data? This will erase all current data.')){
        localStorage.removeItem('students'); localStorage.removeItem('tests'); location.reload();
    }
});

// Search
searchInput.addEventListener('input', renderStudents);

// Initialize
renderStudents();
renderTests();
renderDashboard();
</script>
</body>
</html>