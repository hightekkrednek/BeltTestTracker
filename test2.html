<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Taekwondo Tracker</title>
<style>
body { font-family: Arial, sans-serif; margin:0; background:#f4f4f9; color:#333; }
h2 { margin-top:0; }
section { background:#fff; margin:20px auto; padding:20px; border-radius:8px; box-shadow:0 0 10px rgba(0,0,0,0.05); max-width:1000px; }
table { width:100%; border-collapse:collapse; margin-bottom:20px; }
th,td { padding:10px; border:1px solid #ddd; text-align:left; font-size:14px; }
th { background:#e2e2f1; }
input[type="text"], input[type="number"], input[type="date"], select { width:95%; padding:6px; box-sizing:border-box; border-radius:4px; border:1px solid #ccc; }
input[type="checkbox"] { width:20px; height:20px; }
button { margin:5px; padding:8px 12px; border-radius:4px; border:none; background:#6c63ff; color:#fff; cursor:pointer; font-size:14px; }
button:hover { background:#534fd1; }
.control-panel { background:#e8e8f8; padding:20px; border-radius:8px; margin:20px auto; max-width:1000px; }

/* Belt colors */
.belt-White{background:#ffffff;}
.belt-White-Stripe{background:#f9f9f9;}
.belt-Yellow{background:#fffacd;}
.belt-Yellow-Stripe{background:#fff8b0;}
.belt-Green{background:#90ee90;}
.belt-Green-Stripe{background:#a0f0a0;}
.belt-Blue{background:#add8e6;}
.belt-Blue-Stripe{background:#b7dfee;}
.belt-Red{background:#ff7f7f;}
.belt-Red-Stripe{background:#ff9999;}
.belt-Black{background:#333333; color:#fff;}
.student-active{background:#e6ffe6;}

/* Modal styles */
.modal { display:none; position:fixed; top:0; left:0; width:100%; height:100%; background: rgba(0,0,0,0.5); justify-content:center; align-items:center; }
.modal-content { background:#fff; padding:20px; border-radius:8px; width:400px; max-width:90%; }
.modal-header { font-weight:bold; margin-bottom:10px; }
.modal-footer { text-align:right; margin-top:10px; }
select[multiple] { height:60px; }
</style>
</head>
<body>

<section id="dashboard">
<h2>Dashboard</h2>
<div id="beltCounts">No belt tests yet.</div>
</section>

<section id="studentsSection">
<h2>Students</h2>
<table id="studentsTable">
<thead>
<tr>
<th>ID</th>
<th>Name</th>
<th>Birthdate</th>
<th>Belt</th>
<th>Instructor</th>
<th>Location</th>
<th>Eligible</th>
<th>Active</th>
<th>Actions</th>
</tr>
</thead>
<tbody></tbody>
</table>
<button onclick="openStudentModal()">Add Student</button>
</section>

<section id="beltTestsSection">
<h2>Belt Tests</h2>
<table id="beltTestsTable">
<thead>
<tr>
<th>Student</th>
<th>Belt</th>
<th>Date</th>
<th>Instructor(s)</th>
<th>Location</th>
<th>Actions</th>
</tr>
</thead>
<tbody></tbody>
</table>
<button onclick="openTestModal()">Add Belt Test</button>
</section>

<section class="control-panel">
<h2>Control Panel</h2>
<div>
<button onclick="importStudents()">Import Students</button>
<button onclick="exportStudents()">Export Students</button>
<button onclick="importTests()">Import Tests</button>
<button onclick="exportTests()">Export Tests</button>
</div>
<div>
<button onclick="manageInstructors()">Manage Instructors</button>
<button onclick="manageLocations()">Manage Locations</button>
<button onclick="resetData()">Reset Data</button>
</div>
</section>

<!-- STUDENT MODAL -->
<div class="modal" id="studentModal">
<div class="modal-content">
<div class="modal-header">Add/Edit Student</div>
<div class="modal-body">
<label>Name: <input type="text" id="studentName"></label><br><br>
<label>Birthdate: <input type="date" id="studentBirthdate"></label><br><br>
<label>Belt: 
<select id="studentBelt">
<option>White</option>
<option>White Stripe</option>
<option>Yellow</option>
<option>Yellow Stripe</option>
<option>Green</option>
<option>Green Stripe</option>
<option>Blue</option>
<option>Blue Stripe</option>
<option>Red</option>
<option>Red Stripe</option>
<option>Black</option>
</select>
</label><br><br>
<label>Instructor: <select id="studentInstructor"></select></label><br><br>
<label>Location: <select id="studentLocation"></select></label><br><br>
<label>Eligible: <input type="checkbox" id="studentEligible"></label><br><br>
<label>Active: <input type="checkbox" id="studentActive"></label>
</div>
<div class="modal-footer">
<button onclick="closeStudentModal()">Cancel</button>
<button onclick="saveStudent()">Save</button>
</div>
</div>
</div>

<!-- BELT TEST MODAL -->
<div class="modal" id="testModal">
<div class="modal-content">
<div class="modal-header">Add/Edit Belt Test</div>
<div class="modal-body">
<label>Student: <select id="testStudentId"></select></label><br><br>
<label>Belt: 
<select id="testBelt">
<option>White</option>
<option>White Stripe</option>
<option>Yellow</option>
<option>Yellow Stripe</option>
<option>Green</option>
<option>Green Stripe</option>
<option>Blue</option>
<option>Blue Stripe</option>
<option>Red</option>
<option>Red Stripe</option>
<option>Black</option>
</select>
</label><br><br>
<label>Date: <input type="date" id="testDate"></label><br><br>
<label>Instructor(s): <select id="testInstructors" multiple></select></label><br><br>
<label>Location: <select id="testLocation"></select></label>
</div>
<div class="modal-footer">
<button onclick="closeTestModal()">Cancel</button>
<button onclick="saveTest()">Save</button>
</div>
</div>
</div>

<script>
// DATA
let students=[], beltTests=[], instructors=[], locations=[], nextStudentId=1000;
let editingStudent=null, editingTest=null;
const beltOptions=["White","White Stripe","Yellow","Yellow Stripe","Green","Green Stripe","Blue","Blue Stripe","Red","Red Stripe","Black"];

// LOCAL STORAGE
function saveAllData(){ 
    localStorage.setItem('students',JSON.stringify(students)); 
    localStorage.setItem('beltTests',JSON.stringify(beltTests)); 
    localStorage.setItem('instructors',JSON.stringify(instructors)); 
    localStorage.setItem('locations',JSON.stringify(locations)); 
    localStorage.setItem('nextStudentId',nextStudentId);
}
function loadAllData(){ 
    students=JSON.parse(localStorage.getItem('students')||'[]'); 
    beltTests=JSON.parse(localStorage.getItem('beltTests')||'[]'); 
    instructors=JSON.parse(localStorage.getItem('instructors')||'[]'); 
    locations=JSON.parse(localStorage.getItem('locations')||'[]'); 
    nextStudentId=parseInt(localStorage.getItem('nextStudentId')||'1000'); 
}

// UTIL
function beltClassName(belt){ return 'belt-'+belt.replace(/\s/g,'-'); }

// DASHBOARD
function updateBeltCounts(){
  if(beltTests.length===0){document.getElementById('beltCounts').innerText="No belt tests yet.";return;}
  let counts={}; beltTests.forEach(t=>{ counts[t.belt]=(counts[t.belt]||0)+1; });
  document.getElementById('beltCounts').innerText=Object.entries(counts).map(([b,n])=>`${b}: ${n}`).join(', ');
}

// POPULATE TABLES
function populateTables(){
    const tbodyS=document.querySelector('#studentsTable tbody'); tbodyS.innerHTML='';
    students.forEach(s=>{ addStudentRowToTable(s); });
    const tbodyT=document.querySelector('#beltTestsTable tbody'); tbodyT.innerHTML='';
    beltTests.forEach(t=>{ addTestRowToTable(t); });
    updateBeltCounts();
}

// STUDENT FUNCTIONS
function openStudentModal(s=null){
  editingStudent=s;
  document.getElementById('studentName').value=s?s.name:'';
  document.getElementById('studentBirthdate').value=s?s.birthdate:'';
  document.getElementById('studentBelt').value=s?s.belt:'White';
  document.getElementById('studentEligible').checked=s?s.eligible:false;
  document.getElementById('studentActive').checked=s?s.active:true;

  const instSel=document.getElementById('studentInstructor'); instSel.innerHTML='';
  instructors.forEach(i=>{const o=document.createElement('option');o.value=i;o.text=i;if(s&&s.instructors.includes(i)) o.selected=true; instSel.add(o);});

  const locSel=document.getElementById('studentLocation'); locSel.innerHTML='';
  locations.forEach(l=>{const o=document.createElement('option');o.value=l;o.text=l;if(s&&s.location===l) o.selected=true; locSel.add(o);});

  document.getElementById('studentModal').style.display='flex';
}
function closeStudentModal(){ document.getElementById('studentModal').style.display='none'; editingStudent=null; }
function saveStudent(){
  const name=document.getElementById('studentName').value.trim();
  if(name===''){alert('Name required'); return;}
  const birthdate=document.getElementById('studentBirthdate').value;
  const belt=document.getElementById('studentBelt').value;
  const instructor=[document.getElementById('studentInstructor').value];
  const location=document.getElementById('studentLocation').value;
  const eligible=document.getElementById('studentEligible').checked;
  const active=document.getElementById('studentActive').checked;

  if(editingStudent){
    editingStudent.name=name; editingStudent.birthdate=birthdate; editingStudent.belt=belt; editingStudent.instructors=instructor; editingStudent.location=location; editingStudent.eligible=eligible; editingStudent.active=active;
  } else {
    const s={id:nextStudentId++, name, birthdate, belt, instructors:instructor, location, eligible, active};
    students.push(s);
  }
  saveAllData(); populateTables(); closeStudentModal();
}
function addStudentRowToTable(s){
  const tbody=document.querySelector('#studentsTable tbody');
  const row=document.createElement('tr');
  if(s.active) row.classList.add('student-active');
  const beltClass=beltClassName(s.belt);
  row.innerHTML=`
    <td>${s.id}</td>
    <td>${s.name}</td>
    <td>${s.birthdate}</td>
    <td class="${beltClass}">${s.belt}</td>
    <td>${s.instructors.join(',')}</td>
    <td>${s.location}</td>
    <td>${s.eligible?'✔':''}</td>
    <td>${s.active?'✔':''}</td>
    <td><button onclick="editStudent(${s.id})">Edit</button><button onclick="deleteStudent(${s.id})">Delete</button></td>
  `;
  tbody.appendChild(row);
}
function editStudent(id){ const s=students.find(x=>x.id===id); if(s) openStudentModal(s);}
function deleteStudent(id){ if(confirm('Delete student?')){students=students.filter(x=>x.id!==id); saveAllData(); populateTables();}}

// BELT TEST FUNCTIONS
function openTestModal(t=null){
  editingTest=t;
  const studentSel=document.getElementById('testStudentId'); studentSel.innerHTML='';
  students.filter(s=>s.active && s.eligible).forEach(s=>{ 
    const o=document.createElement('option'); 
    o.value=s.id; 
    o.text=`${s.name} (${s.id})`; 
    if(t&&t.studentId===s.id) o.selected=true; 
    studentSel.add(o); 
  });
  document.getElementById('testBelt').value=t?t.belt:'White';
  document.getElementById('testDate').value=t?t.date:'';
  const selI=document.getElementById('testInstructors'); selI.innerHTML='';
  instructors.forEach(i=>{const o=document.createElement('option'); o.value=i; o.text=i; if(t&&t.instructors.includes(i)) o.selected=true; selI.add(o);});
  const selL=document.getElementById('testLocation'); selL.innerHTML='';
  locations.forEach(l=>{const o=document.createElement('option'); o.value=l; o.text=l; if(t&&t.location===l) o.selected=true; selL.add(o);});
  document.getElementById('testModal').style.display='flex';
}
function closeTestModal(){ document.getElementById('testModal').style.display='none'; editingTest=null; }
function saveTest(){
  const studentId=parseInt(document.getElementById('testStudentId').value);
  const belt=document.getElementById('testBelt').value;
  const date=document.getElementById('testDate').value;
  if(isNaN(studentId)||!belt||!date){alert('Student, Belt, and Date required'); return;}
  const instructorsSelected=[...document.getElementById('testInstructors').selectedOptions].map(o=>o.value);
  const location=document.getElementById('testLocation').value;
  if(editingTest){ editingTest.studentId=studentId; editingTest.belt=belt; editingTest.date=date; editingTest.instructors=instructorsSelected; editingTest.location=location;}
  else{ beltTests.push({studentId,belt,date,instructors:instructorsSelected,location}); }
  saveAllData(); populateTables(); closeTestModal();
}
function addTestRowToTable(t){
  const tbody=document.querySelector('#beltTestsTable tbody');
  const s=students.find(st=>st.id===t.studentId);
  const studentName=s?s.name+' ('+s.id+')':'Unknown';
  const row=document.createElement('tr');
  const beltClass=beltClassName(t.belt);
  row.innerHTML=`
    <td>${studentName}</td>
    <td class="${beltClass}">${t.belt}</td>
    <td>${t.date}</td>
    <td>${t.instructors.join(',')}</td>
    <td>${t.location}</td>
    <td><button onclick="editTest(${beltTests.indexOf(t)})">Edit</button><button onclick="deleteTest(${beltTests.indexOf(t)})">Delete</button></td>
  `;
  tbody.appendChild(row);
}
function editTest(index){ openTestModal(beltTests[index]); }
function deleteTest(index){ if(confirm('Delete this test?')){ beltTests.splice(index,1); saveAllData(); populateTables(); }}

// INSTRUCTORS & LOCATIONS
function manageInstructors(){ const val=prompt('Comma-separated instructors', instructors.join(',')); if(val!==null){ instructors=val.split(',').map(x=>x.trim()).filter(x=>x); saveAllData(); populateTables(); } }
function manageLocations(){ const val=prompt('Comma-separated locations', locations.join(',')); if(val!==null){ locations=val.split(',').map(x=>x.trim()).filter(x=>x); saveAllData(); populateTables(); } }

// IMPORT/EXPORT JSON
function importStudents(){ const f=document.createElement('input'); f.type='file'; f.accept='.json'; f.onchange=e=>{ const reader=new FileReader(); reader.onload=ev=>{ const imported=JSON.parse(ev.target.result); imported.forEach(s=>{ if(!students.find(x=>x.id===s.id)) students.push(s); }); saveAllData(); populateTables(); }; reader.readAsText(e.target.files[0]); }; f.click(); }
function exportStudents(){ const blob=new Blob([JSON.stringify(students,null,2)],{type:'application/json'}); const url=URL.createObjectURL(blob); const a=document.createElement('a'); a.href=url; a.download='students.json'; a.click(); URL.revokeObjectURL(url);}
function importTests(){ const f=document.createElement('input'); f.type='file'; f.accept='.json'; f.onchange=e=>{ const reader=new FileReader(); reader.onload=ev=>{ const imported=JSON.parse(ev.target.result); imported.forEach(t=>{ beltTests.push(t); }); saveAllData(); populateTables(); }; reader.readAsText(e.target.files[0]); }; f.click();}
function exportTests(){ const blob=new Blob([JSON.stringify(beltTests,null,2)],{type:'application/json'}); const url=URL.createObjectURL(blob); const a=document.createElement('a'); a.href=url; a.download='beltTests.json'; a.click(); URL.revokeObjectURL(url); }

// RESET
function resetData(){ if(confirm('Reset all data?')){ students=[]; beltTests=[]; instructors=[]; locations=[]; nextStudentId=1000; saveAllData(); populateTables();}}

// INIT
loadAllData(); populateTables();
</script>

</body>
</html>