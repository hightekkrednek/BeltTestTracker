<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Taekwondo Tracker</title>
<style>
body { font-family: Arial, sans-serif; margin:0; background:#f4f4f9; color:#333; }
h2 { margin-top:0; }
section { background:#fff; margin:20px auto; padding:20px; border-radius:8px; box-shadow:0 0 10px rgba(0,0,0,0.05); max-width:95%; }
table { width:100%; border-collapse:collapse; margin-bottom:20px; table-layout:auto; word-wrap:break-word; }
.table-container { overflow-x: auto; width: 100%; }
th,td { padding:10px; border:1px solid #ddd; text-align:left; font-size:14px; overflow-wrap: break-word; }
th { background:#e2e2f1; }
input[type="text"], input[type="number"], input[type="date"], select { width:95%; padding:6px; border-radius:4px; border:1px solid #ccc; }
input[type="checkbox"] { width:20px; height:20px; }
button { margin:5px; padding:8px 12px; border-radius:4px; border:none; background:#6c63ff; color:#fff; cursor:pointer; font-size:14px; }
button:hover { background:#534fd1; }
.student-active { background:#e6ffe6; }
.belt-White{background:#ffffff;}
.belt-Yellow{background:#fffacd;}
.belt-Green{background:#90ee90;}
.belt-Blue{background:#add8e6;}
.belt-Red{background:#ff7f7f;}
.belt-Black{background:#333;color:#fff;}
.modal { display:none; position:fixed; top:0; left:0; width:100%; height:100%; background: rgba(0,0,0,0.5); justify-content:center; align-items:center; z-index:1000; overflow:auto; padding:10px;}
.modal-content { background:#fff; padding:20px; border-radius:8px; width:400px; max-width:100%; max-height:90%; overflow-y:auto; }
.modal-header { font-weight:bold; margin-bottom:10px; }
.modal-footer { text-align:right; margin-top:10px; }
</style>
</head>
<body>

<h1 style="text-align:center; background:#222; color:#fff; padding:15px 0; margin:0;">Impact Martial Arts Tracker</h1>

<section id="studentsSection">
  <h2>Students</h2>
  <div id="studentCounts" style="margin-bottom:10px;">Active: 0 | Inactive: 0</div>
  <div class="table-container">
    <table id="studentsTable">
      <thead>
        <tr>
          <th>ID</th>
          <th>Name</th>
          <th>DOB</th>
          <th>Age</th>
          <th>Belt</th>
          <th>Instructor</th>
          <th>Location</th>
          <th>Eligible</th>
          <th>Active</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>
  <button onclick="openStudentModal()">Add Student</button>
</section>

<section id="beltTestsSection">
  <h2>Belt Tests</h2>
  <div id="eligibleCounts" style="margin-bottom:10px;">Eligible Students: 0</div>
  <div class="table-container">
    <table id="beltTestsTable">
      <thead>
        <tr>
          <th>Student</th>
          <th>Belt</th>
          <th>Date</th>
          <th>Instructor(s)</th>
          <th>Location</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>
  <button onclick="openTestModal()">Add Belt Test</button>
</section>

<!-- MODALS (simplified for brevity) -->
<div class="modal" id="studentModal">
<div class="modal-content">
<div class="modal-header">Add/Edit Student</div>
<div class="modal-body">
<label>Name: <input type="text" id="studentName"></label><br><br>
<label>DOB: <input type="date" id="studentBirthdate"></label><br><br>
<label>Belt: <select id="studentBelt"></select></label><br><br>
<label>Instructor: <select id="studentInstructor"></select></label><br><br>
<label>Location: <select id="studentLocation"></select></label><br><br>
<label>Eligible: <input type="checkbox" id="studentEligible"></label><br><br>
<label>Active: <input type="checkbox" id="studentActive"></label>
</div>
<div class="modal-footer">
<button onclick="closeStudentModal()">Cancel</button>
<button onclick="saveStudent()">Save</button>
</div>
</div>
</div>

<div class="modal" id="testModal">
<div class="modal-content">
<div class="modal-header">Add/Edit Belt Test</div>
<div class="modal-body">
<label>Student: <select id="testStudentId"></select></label><br><br>
<label>Belt: <select id="testBelt"></select></label><br><br>
<label>Date: <input type="date" id="testDate"></label><br><br>
<label>Instructor(s): <select id="testInstructors" multiple></select></label><br><br>
<label>Location: <select id="testLocation"></select></label>
</div>
<div class="modal-footer">
<button onclick="closeTestModal()">Cancel</button>
<button onclick="saveTest()">Save</button>
</div>
</div>
</div>

<script>
let students=[], beltTests=[], belts=["White","Yellow","Green","Blue","Red","Black"], nextStudentId=1000;

function saveAllData(){
  localStorage.setItem('students',JSON.stringify(students));
  localStorage.setItem('beltTests',JSON.stringify(beltTests));
  localStorage.setItem('nextStudentId',nextStudentId);
}

function loadAllData(){
  students=JSON.parse(localStorage.getItem('students')||'[]');
  beltTests=JSON.parse(localStorage.getItem('beltTests')||'[]');
  nextStudentId=parseInt(localStorage.getItem('nextStudentId')||'1000');
  populateTables();
}

function updateStudentCounts(){
  let active=students.filter(s=>s.active).length;
  let inactive=students.filter(s=>!s.active).length;
  document.getElementById('studentCounts').innerText=`Active: ${active} | Inactive: ${inactive}`;
  let eligibleActive=students.filter(s=>s.active && s.eligible).length;
  document.getElementById('eligibleCounts').innerText=`Eligible Students: ${eligibleActive}`;
}

function populateTables(){
  const tbodyS=document.querySelector('#studentsTable tbody'); tbodyS.innerHTML='';
  students.forEach(s=>{
    const row=document.createElement('tr'); if(s.active) row.classList.add('student-active');
    let ageText='';
    if(s.birthdate){ const b=new Date(s.birthdate), now=new Date(); ageText=now.getFullYear()-b.getFullYear(); const m=now.getMonth()-b.getMonth(); if(m<0 || (m===0 && now.getDate()<b.getDate())) ageText--; }
    row.innerHTML=`<td>${s.id}</td><td>${s.name}</td><td>${s.birthdate}</td><td>${ageText}</td><td class="belt-${s.belt.replace(/\s/g,'-')}">${s.belt}</td><td>${s.instructor||''}</td><td>${s.location||''}</td><td>${s.eligible?'✔':''}</td><td>${s.active?'✔':''}</td><td><button onclick="editStudent(${s.id})">Edit</button></td>`;
    tbodyS.appendChild(row);
  });
  const tbodyT=document.querySelector('#beltTestsTable tbody'); tbodyT.innerHTML='';
  beltTests.forEach(t=>{
    const s=students.find(st=>st.id===t.studentId); const name=s?s.name:'Unknown';
    const row=document.createElement('tr');
    row.innerHTML=`<td>${name}</td><td class="belt-${t.belt.replace(/\s/g,'-')}">${t.belt}</td><td>${t.date}</td><td>${t.instructors||''}</td><td>${t.location||''}</td><td><button onclick="editTest(${beltTests.indexOf(t)})">Edit</button></td>`;
    tbodyT.appendChild(row);
  });
  updateStudentCounts();
}

// Student modal actions
let editingStudent=null;
function openStudentModal(s=null){
  editingStudent=s;
  document.getElementById('studentName').value=s?s.name:'';
  document.getElementById('studentBirthdate').value=s?s.birthdate:'';
  document.getElementById('studentBelt').innerHTML=''; belts.forEach(b=>{ const o=document.createElement('option'); o.value=b; o.text=b; if(s&&s.belt===b)o.selected=true; document.getElementById('studentBelt').add(o); });
  document.getElementById('studentEligible').checked=s?s.eligible:false;
  document.getElementById('studentActive').checked=s?s.active:true;
  document.getElementById('studentModal').style.display='flex';
}
function closeStudentModal(){ document.getElementById('studentModal').style.display='none'; editingStudent=null; }
function saveStudent(){
  const name=document.getElementById('studentName').value.trim();
  if(!name){ alert('Name required'); return;}
  const birthdate=document.getElementById('studentBirthdate').value;
  const belt=document.getElementById('studentBelt').value;
  const eligible=document.getElementById('studentEligible').checked;
  const active=document.getElementById('studentActive').checked;
  if(editingStudent){
    editingStudent.name=name; editingStudent.birthdate=birthdate; editingStudent.belt=belt; editingStudent.eligible=eligible; editingStudent.active=active;
  } else {
    students.push({id:nextStudentId++, name, birthdate, belt, eligible, active});
  }
  saveAllData(); populateTables(); closeStudentModal();
}

// Belt test modal
let editingTest=null;
function openTestModal(t=null){ editingTest=t; document.getElementById('testModal').style.display='flex'; }
function closeTestModal(){ document.getElementById('testModal').style.display='none'; editingTest=null; }

// On load
window.onload=()=>{ loadAllData(); };
</script>

</body>
</html>